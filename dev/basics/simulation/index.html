<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simulation of PuMaS Models · PuMaS</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>PuMaS</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../../tutorials/introduction/">Introduction to PuMaS</a></li></ul></li><li><span class="toctext">Basics</span><ul><li><a class="toctext" href="../overview/">Overview of PuMaS</a></li><li><a class="toctext" href="../models/">Defining NLME Models</a></li><li><a class="toctext" href="../doses_subjects_populations/">Dosage Regimens, Subjects, and Populations</a></li><li class="current"><a class="toctext" href>Simulation of PuMaS Models</a><ul class="internal"><li><a class="toctext" href="#The-simobs-Function-1">The <code>simobs</code> Function</a></li><li><a class="toctext" href="#Handling-Simulated-Returns-1">Handling Simulated Returns</a></li><li><a class="toctext" href="#Visualizing-Simulated-Returns-1">Visualizing Simulated Returns</a></li></ul></li><li><a class="toctext" href="../estimation/">Estimating Parameters of PuMaS Models</a></li><li><a class="toctext" href="../nca/">Noncompartmental Analysis (NCA)</a></li><li><a class="toctext" href="../faq/">Frequently Asked Questions (FAQ)</a></li></ul></li><li><span class="toctext">Model Components</span><ul><li><a class="toctext" href="../../model_components/domains/">Domains</a></li><li><a class="toctext" href="../../model_components/dosing_control/">Dosing Control Parameters (DCP)</a></li><li><a class="toctext" href="../../model_components/dynamical_types/">Dynamical Problem Types</a></li></ul></li><li><span class="toctext">Diagnostics</span><ul><li><a class="toctext" href="../../analysis/diagnostics/">Simulation and Estimation Diagnostics</a></li><li><a class="toctext" href="../../analysis/sensitivity/">Local and Global Sensitivity Analysis</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Basics</li><li><a href>Simulation of PuMaS Models</a></li></ul><a class="edit-page" href="https://github.com/UMCTM/PuMaSDocs.jl/blob/master/docs/src/basics/simulation.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Simulation of PuMaS Models</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Simulation-of-PuMaS-Models-1" href="#Simulation-of-PuMaS-Models-1">Simulation of PuMaS Models</a></h1><h2><a class="nav-anchor" id="The-simobs-Function-1" href="#The-simobs-Function-1">The <code>simobs</code> Function</a></h2><p>Simulation of a <code>PuMaSModel</code> are performed via the <code>simobs</code> function. The function is given by the values:</p><pre><code class="language-julia">simobs(m,data,param,[randeffs];kwargs...)</code></pre><p>The terms in the function call are:</p><ul><li><code>m</code>: the <code>PuMaSModel</code>, either defined via the <code>@model</code> DSL or the function-based interface.</li><li><code>data</code>: either a <code>Subject</code> or a <code>Population</code>.</li><li><code>param</code>: a <code>NamedTuple</code> of parameters which conform to the <code>ParamSet</code> of the model.</li><li><code>randeffs</code>: an optional argument for the random effects for the simulation. If the random effects are not given, they are sampled as described in the model.</li><li><code>kwargs</code>: extra keyword arguments.</li></ul><p>Additionally, the following keyword arguments can be used:</p><ul><li><code>alg</code>: the type for which differential equation solver method to use. For example, <code>alg=Rodas5()</code> specifies the usage of the 5th order Rosenbrock method for ODEs described in the <a href="http://docs.juliadiffeq.org/latest/solvers/ode_solve.html#Rosenbrock-Methods-1">DifferentialEquations.jl solver documentation page</a>. Defaults to an automatic stiffness detection algorithm for ODEs.</li><li><code>parallel_type</code>: the type of parallelism to use internally for simulating a <code>Population</code>. The options are:<ul><li><code>PuMaS.Serial</code>: No parallelism.</li><li><code>PuMaS.Threads</code>: Shared memory multithreading.</li><li><code>PuMaS.Distributed</code>: Distributed (multinode, multi-computer) parallelism.</li></ul>The default is <code>PuMaS.Threads</code>.</li><li>Any keyword argument in the DifferentialEquations.jl common solver arguments. These are documented on the <a href="http://docs.juliadiffeq.org/latest/basics/common_solver_opts.html">DifferentialEquations.jl common solver options page</a>.</li></ul><p>The result of <code>simobs</code> function is a <code>SimulatedObservation</code> if the <code>data</code> was <code>Subject</code> and a <code>SimulatedPopulation</code> if the <code>data</code> was a <code>Population</code>.</p><h2><a class="nav-anchor" id="Handling-Simulated-Returns-1" href="#Handling-Simulated-Returns-1">Handling Simulated Returns</a></h2><p>When running</p><pre><code class="language-julia">sim = simobs(m,data,param)</code></pre><p><code>sim</code> is a <code>SimulatedObservation</code> which can be accessed via its fields. These fields are:</p><ul><li><code>subject</code>: the <code>Subject</code> used to generate the observation</li><li><code>times</code>: the times associated with the observations</li><li><code>observed</code>: the resulting observations of the simulation</li></ul><p>If the <code>@model</code> DSL is used, then <code>observed</code> is a <code>NamedTuple</code> where the names give the associated values. From the function-based interface, <code>observed</code> is the chosen return type of the <code>observed</code> function in the model specification.</p><p>A <code>SimulatedPopulation</code> is a collection of <code>SimulatedObservation</code>s, and when indexed like <code>sim[i]</code> it returns the <code>SimulatedObservation</code> of the <code>i</code>th simulation subject.</p><h2><a class="nav-anchor" id="Visualizing-Simulated-Returns-1" href="#Visualizing-Simulated-Returns-1">Visualizing Simulated Returns</a></h2><p>These objects have automatic plotting and dataframe visualization. To plot a simulation return, simply call plot on the output using <a href="https://github.com/JuliaPlots/Plots.jl">Plots.jl</a>. For example, the following will run a simulation and plot the observed variables:</p><pre><code class="language-julia">obs = simobs(m,data,param)
using Plots
plot(obs)</code></pre><p>By default this generates a plot for each derived variable. To choose which variables to plot, the <code>obsnames</code> argument can be given which declares indices or derived variable names to plot. For example, <code>plot(obs,obsnames=[:dv1,:dv2])</code> would only plot the values <code>dv1</code> and <code>dv2</code>. In addition, all of the <a href="http://docs.juliaplots.org/latest/attributes/">Plots.jl attributes</a> can be used in this <code>plot</code> command. For more information on using Plots.jl, please see <a href="http://docs.juliaplots.org/latest/tutorial/">the Plots.jl tutorial</a>. Note that if the simulated return is a <code>SimulatedPopulation</code>, then the plots overlay the results of the various subjects.</p><p>To generate the DataFrame associated with the observed outputs, simply call <code>DataFrame</code> on the simulated return. For example, the following builds the tabular output from the returned object:</p><pre><code class="language-julia">obs = simobs(m,data,param)
df = DataFrame(obs)</code></pre><footer><hr/><a class="previous" href="../doses_subjects_populations/"><span class="direction">Previous</span><span class="title">Dosage Regimens, Subjects, and Populations</span></a><a class="next" href="../estimation/"><span class="direction">Next</span><span class="title">Estimating Parameters of PuMaS Models</span></a></footer></article></body></html>
